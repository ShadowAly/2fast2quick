{% extends "base.html" %}

{% block content %}
<h2>
    {% if game.logo %}
        <img src="{{ url_for('static', filename='uploads/' + game.logo) }}" alt="Logo" style="max-height: 40px; margin-right: 10px;">
    {% endif %}
    {{ game.name }} - Servers
</h2>

<form method="GET" class="mb-4">
    <div class="form-group">
        <input type="text" name="search" placeholder="Search by Name or Creator" value="{{ request.args.get('search', '') }}" class="form-control" style="width: 300px; display: inline-block;">
    </div>
    
    <div class="form-group">
        <p><strong>Filter by Region:</strong></p>
        {% for region in regions %}
            <label style="margin-right: 10px;">
                <input type="radio" name="region" value="{{ region }}" {% if region == selected_region %}checked{% endif %}>
                {{ region }}
            </label>
        {% endfor %}
        <label>
            <input type="radio" name="region" value="" {% if not selected_region %}checked{% endif %}>
            All
        </label>
    </div>

    <button type="submit" class="btn btn-primary">Search</button>
</form>

<hr>

{% if not servers %}
    <p>No servers found.</p>
{% else %}
    <ul class="list-group">
        {% for server in servers %}
            <li class="list-group-item" style="margin-bottom: 15px;">
                <strong>{{ server.name }}</strong> ({{ server.region }}) - IP: {{ server.ip }}
                <button onclick="copyIP('{{ server.ip }}')" class="btn btn-sm btn-info ml-2">Copy IP</button><br>
                Created by: {{ server.created_by }} - Max Players: {{ server.max_players }}<br>
                <a href="{{ url_for('server_details', game_id=game.doc_id, server_id=server.doc_id) }}" class="btn btn-link">View Details</a>

                {% if current_user.username == 'Admin' or server.created_by == current_user.username %}
                    <form method="POST" action="{{ url_for('delete_server', game_id=game.doc_id, server_id=server.doc_id) }}" style="display:inline;">
                        <button type="submit" class="btn btn-danger">
                            {% if current_user.username == 'Admin' %}
                                Delete Server
                            {% else %}
                                Delete Server
                            {% endif %}
                        </button>
                    </form>
                {% endif %}
            </li>
        {% endfor %}
    </ul>
{% endif %}

{% if current_user.can_create_server() %}
    <a href="{{ url_for('add_server', game_id=game.doc_id) }}" class="btn btn-primary">Add Server</a>
{% elif current_user.plan == 'free' %}
    <a href="{{ url_for('plans') }}" class="btn btn-success">Upgrade to Create Servers</a>
{% else %}
    <button class="btn btn-secondary" disabled>Server Limit Reached</button>
{% endif %}

<script>
    function copyIP(ip) {
        navigator.clipboard.writeText(ip).then(function() {
            alert('IP copied to clipboard');
        }, function() {
            alert('Failed to copy IP');
        });
    }
</script>
{% endblock %}
